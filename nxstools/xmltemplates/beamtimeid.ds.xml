<?xml version='1.0'?>
<definition>
  <datasource type="PYEVAL" name="$(name)">
    <result name="result">
import os
import socket      
compath = "$(commissiondir)"
curpath = "$(currentdir)"
locpath = "$(localdir)"
curprefix = "$(currentprefix)"
curext = "$(currentpostfix)"
comprefix = "$(commissionprefix)"
comext = "$(commissionpostfix)"

ds.result = None      
root = commonblock["__nxroot__"]
fpath = root.filename
if fpath.startswith(curpath):
    try: 
        if os.path.isdir(curpath):
            btml = [fl for fl in  os.listdir(curpath)
                    if (fl.startswith(curprefix)
                        and fl.endswith(curext))]
        if btml:
            ds.result = btml[0][len(curprefix):-len(curext)]
    except:
        pass
if not ds.result and fpath.startswith(compath):
    try: 
        if os.path.isdir(compath):
            btml = [fl for fl in  os.listdir(compath)
                    if (fl.startswith(comprefix)
                        and fl.endswith(comext))]
        if btml:
            ds.result = btml[0][len(comprefix):-len(comext)]
    except:
        pass
if not ds.result and fpath.startswith(locpath):
    try:
        if os.path.isdir(locpath):
            btml = [fl for fl in  os.listdir(locpath)
                    if (fl.startswith(curprefix)
                        and fl.endswith(curext))]
            if btml:
                ds.result = btml[0][len(curprefix):-len(curext)]
            else:
                btml = [fl for fl in  os.listdir(locpath)
                        if (fl.startswith(comprefix)
                            and fl.endswith(comext))]
                if btml:
                    ds.result = btml[0][len(comprefix):-len(comext)]
    except:    
        pass
if not ds.result:
    ds.result = "%s_%s@%s" % ("$(shortname)", ds.start_time, socket.gethostname())
    </result>
    $datasources.start_time
  </datasource>
</definition>
